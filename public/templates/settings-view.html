<div class="{{containerClass}}">
    <div class="peer-count-display">üîó Peers: <span id="peer-count">{{peerCount}}</span></div>
    <button class="{{buttonClass}} profiles-btn" id="show-profiles-btn">üé≠ Profiles</button>
    <button class="{{buttonClass}} log-view-btn" id="show-log-btn">üìú Log</button>
    <div class="settings-header">
        <h1 class="{{titleClass}}">‚öôÔ∏è Settings</h1>
        {{#if showProfileName}}
        <div class="profile-subtitle">{{profileName}}</div>
        {{/if}}
    </div>

    <div class="{{sectionClass}}">
        <h2>Player Information</h2>
        <div class="{{fieldClass}}">
            <label for="player-name-input">Player Name:</label>
            <input type="text" id="player-name-input" value="{{playerName}}" placeholder="Enter your player name" />
        </div>
        <div class="{{fieldClass}}">
            <label>Peer ID:</label>
            <span id="peer-id-display" class="peer-id-readonly">{{peerId}}</span>
        </div>
    </div>

    <div class="{{sectionClass}}">
        <h2>Private Notes</h2>
        <div class="{{fieldClass}}">
            <label for="private-notes-editor">Notes (not shared with other players):</label>
            <div id="private-notes-editor" class="milkdown-editor"></div>
        </div>
    </div>

    <div class="{{sectionClass}}">
        <h2>Friends</h2>
        <div id="friends-list">
            {{#each friends}}
            <div class="friend-card" data-friend-id="{{peerId}}" data-expanded="false">
                <!-- Collapsed State (default) -->
                <div class="friend-card-collapsed">
                    <div class="friend-collapsed-content">
                        <div class="friend-collapsed-name">
                            {{playerName}}
                            {{#if pending}}
                            <span class="pending-badge" title="Friend request pending acknowledgment">‚è≥ Pending</span>
                            {{/if}}
                        </div>
                        <div class="friend-collapsed-peerid">{{peerId}}</div>
                        {{#if notes}}
                        <div class="friend-collapsed-notes">{{notes}}</div>
                        {{/if}}
                    </div>
                    <button class="friend-kill-btn" data-friend-id="{{peerId}}" title="Remove friend">üíÄ</button>
                </div>

                <!-- Expanded State -->
                <div class="friend-card-expanded" style="display: none;">
                    <div class="friend-card-header">
                        <h3>Friend Details
                            {{#if pending}}
                            <span class="pending-badge" title="Friend request pending acknowledgment">‚è≥ Pending</span>
                            {{/if}}
                        </h3>
                        <button class="friend-collapse-btn" data-friend-id="{{peerId}}" title="Collapse">‚¨ÜÔ∏è</button>
                    </div>
                    <div class="friend-expanded-content">
                        <div class="friend-field">
                            <label for="friend-name-{{peerId}}">Player Name:</label>
                            <input type="text" id="friend-name-{{peerId}}" class="friend-name-input" data-friend-id="{{peerId}}" value="{{playerName}}" />
                        </div>
                        <div class="friend-field">
                            <label for="friend-peerid-{{peerId}}">Peer ID:</label>
                            <span id="friend-peerid-{{peerId}}" class="friend-peer-id">{{peerId}}</span>
                        </div>
                        <div class="friend-notes-section">
                            <label for="friend-notes-{{peerId}}">Private Notes:</label>
                            <div class="milkdown-editor" id="friend-notes-{{peerId}}"></div>
                        </div>
                        <button class="remove-friend-btn" data-friend-id="{{peerId}}">Remove</button>
                    </div>
                </div>
            </div>
            {{/each}}
        </div>
        <div class="friend-actions">
            <button class="{{buttonClass}}" id="add-friend-by-peerid-btn">Add Friend by Peer ID</button>
        </div>

        <!-- Pending New Invitations List - HIDDEN (backend logic remains for automatic retry) -->
        <div id="pending-new-invitations-section" class="pending-invitations-section" style="display: none;">
            <h3 class="collapsible-header">Pending Invitations <span class="badge" id="pending-invitations-count">0</span></h3>
            <div id="pending-invitations-list" class="pending-invitations-list"></div>
        </div>

        <!-- Ignored Peers List -->
        <div id="ignored-peers-section" class="ignored-peers-section">
            <h3 class="collapsible-header">Ignored Peers <span class="badge" id="ignored-peers-count">0</span></h3>
            <div id="ignored-peers-list" class="ignored-peers-list"></div>
        </div>
    </div>

    <div class="settings-actions">
        <button class="{{backButtonClass}}">Back to Menu</button>
    </div>

    <!-- Add Friend by Peer ID Modal -->
    <div id="add-friend-peerid-modal" class="modal" style="display: none;">
        <div class="modal-content">
            <h2>Add Friend by Peer ID</h2>
            <div class="modal-field">
                <label for="new-friend-name">Friend Name:</label>
                <input type="text" id="new-friend-name" placeholder="Enter a friendly name" />
            </div>
            <div class="modal-field">
                <label for="new-friend-peerid">Peer ID:</label>
                <input type="text" id="new-friend-peerid" placeholder="Paste peer ID here" />
            </div>
            <div class="modal-field">
                <label for="new-friend-notes">Notes:</label>
                <div id="new-friend-notes" class="milkdown-editor"></div>
            </div>
            <div class="modal-actions">
                <button id="add-friend-peerid-submit-btn" class="{{buttonClass}}">Add Friend</button>
                <button id="close-add-friend-peerid-modal-btn" class="{{buttonClass}}">Cancel</button>
            </div>
        </div>
    </div>
</div>