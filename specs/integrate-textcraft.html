<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Textcraft Integration Plan for Hollow World</title>

    <!-- Mermaid for diagrams -->
    <script type="module">
        import mermaid from 'https://cdn.jsdelivr.net/npm/mermaid@10/dist/mermaid.esm.min.mjs';
        mermaid.initialize({
            startOnLoad: true,
            theme: 'dark',
            themeVariables: {
                darkMode: true,
                background: '#1e1e1e',
                primaryColor: '#4a9eff',
                secondaryColor: '#ff6b6b',
                tertiaryColor: '#4ecdc4',
                primaryTextColor: '#e0e0e0',
                secondaryTextColor: '#b0b0b0',
                lineColor: '#666',
                textColor: '#e0e0e0'
            }
        });
    </script>

    <!-- Highlight.js for syntax highlighting -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/styles/atom-one-dark.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/highlight.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/languages/typescript.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/languages/bash.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/languages/yaml.min.js"></script>

    <style>
        :root {
            --bg-primary: #1e1e1e;
            --bg-secondary: #252526;
            --bg-tertiary: #2d2d30;
            --bg-code: #1e1e1e;
            --text-primary: #e0e0e0;
            --text-secondary: #b0b0b0;
            --text-muted: #808080;
            --accent-primary: #4a9eff;
            --accent-secondary: #4ecdc4;
            --border-color: #3e3e42;
            --link-color: #4a9eff;
            --link-hover: #6bb3ff;
            --header-bg: #2d2d30;
            --toc-bg: #252526;
            --scrollbar-bg: #1e1e1e;
            --scrollbar-thumb: #424242;
            --success-color: #4ecdc4;
            --error-color: #ff6b6b;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
            background-color: var(--bg-primary);
            color: var(--text-primary);
            line-height: 1.6;
            font-size: 16px;
        }

        /* Scrollbar styling */
        ::-webkit-scrollbar {
            width: 12px;
            height: 12px;
        }

        ::-webkit-scrollbar-track {
            background: var(--scrollbar-bg);
        }

        ::-webkit-scrollbar-thumb {
            background: var(--scrollbar-thumb);
            border-radius: 6px;
        }

        ::-webkit-scrollbar-thumb:hover {
            background: #555;
        }

        /* Header */
        header {
            background-color: var(--header-bg);
            border-bottom: 2px solid var(--accent-primary);
            padding: 2rem 2rem 1rem;
            position: sticky;
            top: 0;
            z-index: 100;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.3);
        }

        h1 {
            font-size: 2rem;
            margin-bottom: 0.5rem;
            color: var(--accent-primary);
            font-weight: 600;
        }

        .subtitle {
            color: var(--text-secondary);
            font-size: 0.9rem;
            margin-bottom: 1rem;
        }

        .metadata {
            display: flex;
            gap: 2rem;
            margin-bottom: 1rem;
            color: var(--text-secondary);
            font-size: 0.85rem;
        }

        .metadata-item {
            display: flex;
            gap: 0.5rem;
        }

        .metadata-item strong {
            color: var(--accent-secondary);
        }

        .source-link {
            display: inline-block;
            color: var(--link-color);
            text-decoration: none;
            font-size: 0.9rem;
            padding: 0.5rem 1rem;
            border: 1px solid var(--link-color);
            border-radius: 4px;
            transition: all 0.2s ease;
        }

        .source-link:hover {
            background-color: var(--link-color);
            color: var(--bg-primary);
        }

        /* Layout */
        .container {
            display: grid;
            grid-template-columns: 300px 1fr;
            max-width: 1800px;
            margin: 0 auto;
            gap: 2rem;
            padding: 2rem;
        }

        @media (max-width: 1024px) {
            .container {
                grid-template-columns: 1fr;
            }

            #toc {
                position: static !important;
                max-height: none !important;
            }
        }

        /* Table of Contents */
        #toc {
            background-color: var(--toc-bg);
            border-radius: 8px;
            padding: 1.5rem;
            position: sticky;
            top: 200px;
            max-height: calc(100vh - 220px);
            overflow-y: auto;
            border: 1px solid var(--border-color);
        }

        #toc h2 {
            font-size: 1.2rem;
            margin-bottom: 1rem;
            color: var(--accent-secondary);
        }

        #toc ul {
            list-style: none;
        }

        #toc li {
            margin-bottom: 0.5rem;
        }

        #toc a {
            color: var(--text-secondary);
            text-decoration: none;
            transition: color 0.2s ease;
            display: block;
            padding: 0.25rem 0;
        }

        #toc a:hover {
            color: var(--link-hover);
            padding-left: 0.5rem;
        }

        #toc .toc-level-1 {
            font-weight: 600;
            margin-top: 0.75rem;
        }

        #toc .toc-level-2 {
            padding-left: 1rem;
            font-size: 0.9rem;
        }

        #toc .toc-level-3 {
            padding-left: 2rem;
            font-size: 0.85rem;
        }

        #toc .toc-level-4 {
            padding-left: 3rem;
            font-size: 0.8rem;
        }

        /* Content */
        #content {
            background-color: var(--bg-secondary);
            border-radius: 8px;
            padding: 2rem;
            border: 1px solid var(--border-color);
            min-width: 0;
        }

        #content h2 {
            font-size: 1.75rem;
            margin-top: 2rem;
            margin-bottom: 1rem;
            padding-bottom: 0.5rem;
            border-bottom: 2px solid var(--accent-secondary);
            color: var(--accent-secondary);
            scroll-margin-top: 200px;
        }

        #content h2:first-child {
            margin-top: 0;
        }

        #content h3 {
            font-size: 1.3rem;
            margin-top: 1.5rem;
            margin-bottom: 0.75rem;
            color: var(--text-primary);
            scroll-margin-top: 200px;
        }

        #content h4 {
            font-size: 1.1rem;
            margin-top: 1.25rem;
            margin-bottom: 0.5rem;
            color: var(--text-secondary);
            scroll-margin-top: 200px;
        }

        #content p {
            margin-bottom: 1rem;
            color: var(--text-primary);
        }

        #content ul, #content ol {
            margin-bottom: 1rem;
            padding-left: 2rem;
        }

        #content li {
            margin-bottom: 0.5rem;
            color: var(--text-primary);
        }

        #content hr {
            border: none;
            border-top: 1px solid var(--border-color);
            margin: 2rem 0;
        }

        /* Links */
        #content a {
            color: var(--link-color);
            text-decoration: none;
            border-bottom: 1px solid transparent;
            transition: border-color 0.2s ease;
        }

        #content a:hover {
            border-bottom-color: var(--link-hover);
        }

        /* Code blocks */
        pre {
            background-color: var(--bg-code) !important;
            border-radius: 6px;
            padding: 1.5rem !important;
            overflow-x: auto;
            margin-bottom: 1.5rem;
            border: 1px solid var(--border-color);
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);
        }

        code {
            font-family: 'Consolas', 'Monaco', 'Courier New', monospace;
            font-size: 0.9rem;
        }

        p code, li code, td code {
            background-color: var(--bg-tertiary);
            padding: 0.2rem 0.4rem;
            border-radius: 3px;
            color: var(--accent-secondary);
            font-size: 0.85rem;
        }

        /* Mermaid diagrams */
        .mermaid {
            background-color: var(--bg-tertiary);
            border-radius: 8px;
            padding: 2rem;
            margin: 1.5rem 0;
            border: 1px solid var(--border-color);
            overflow-x: auto;
        }

        /* Tables */
        table {
            width: 100%;
            border-collapse: collapse;
            margin: 1.5rem 0;
            background-color: var(--bg-tertiary);
            border-radius: 6px;
            overflow: hidden;
        }

        th, td {
            padding: 0.75rem 1rem;
            text-align: left;
            border-bottom: 1px solid var(--border-color);
        }

        th {
            background-color: var(--bg-code);
            color: var(--accent-secondary);
            font-weight: 600;
        }

        tr:last-child td {
            border-bottom: none;
        }

        tr:hover {
            background-color: rgba(74, 158, 255, 0.1);
        }

        /* Note/info blocks */
        .info-block {
            background-color: var(--bg-tertiary);
            border-left: 4px solid var(--accent-primary);
            padding: 1rem 1.5rem;
            margin: 1.5rem 0;
            border-radius: 4px;
        }

        .info-block strong {
            color: var(--accent-primary);
        }

        /* Status badges */
        .status {
            display: inline-block;
            padding: 0.25rem 0.75rem;
            border-radius: 12px;
            font-size: 0.85rem;
            font-weight: 600;
            background-color: var(--accent-primary);
            color: var(--bg-primary);
        }

        /* Checkmark and cross symbols */
        .checkmark {
            color: var(--success-color);
            font-weight: bold;
        }

        .crossmark {
            color: var(--error-color);
            font-weight: bold;
        }

        /* Footer */
        footer {
            text-align: center;
            padding: 2rem;
            color: var(--text-muted);
            font-size: 0.9rem;
        }

        /* Responsive adjustments */
        @media (max-width: 768px) {
            header {
                padding: 1rem;
            }

            h1 {
                font-size: 1.5rem;
            }

            .container {
                padding: 1rem;
                gap: 1rem;
            }

            #content {
                padding: 1rem;
            }

            #content h2 {
                font-size: 1.4rem;
            }

            #content h3 {
                font-size: 1.2rem;
            }

            pre {
                padding: 1rem !important;
            }

            .metadata {
                flex-direction: column;
                gap: 0.5rem;
            }
        }

        /* Animation for TOC active state */
        #toc a.active {
            color: var(--accent-primary);
            font-weight: 600;
        }

        /* Light mode support */
        @media (prefers-color-scheme: light) {
            :root {
                --bg-primary: #ffffff;
                --bg-secondary: #f5f5f5;
                --bg-tertiary: #e8e8e8;
                --bg-code: #282c34;
                --text-primary: #2c3e50;
                --text-secondary: #546e7a;
                --text-muted: #95a5a6;
                --accent-primary: #2196F3;
                --accent-secondary: #00bcd4;
                --border-color: #e0e0e0;
                --link-color: #2196F3;
                --link-hover: #1976D2;
                --header-bg: #f8f9fa;
                --toc-bg: #f5f5f5;
                --scrollbar-bg: #f5f5f5;
                --scrollbar-thumb: #bdbdbd;
                --success-color: #00a86b;
                --error-color: #d32f2f;
            }
        }
    </style>
</head>
<body>
    <header>
        <h1>Textcraft Integration Plan for Hollow World</h1>
        <div class="metadata">
            <div class="metadata-item">
                <strong>Plan Version:</strong> <span>2.0</span>
            </div>
            <div class="metadata-item">
                <strong>Date:</strong> <span>2025-10-19</span>
            </div>
            <div class="metadata-item">
                <strong>Status:</strong> <span class="status">Planning</span>
            </div>
        </div>
        <a href="integrate-textcraft-2.md" class="source-link">View Markdown Source</a>
    </header>

    <div class="container">
        <nav id="toc">
            <h2>Table of Contents</h2>
            <ul>
                <li class="toc-level-1"><a href="#executive-summary">Executive Summary</a></li>
                <li class="toc-level-2"><a href="#key-integration-points">Key Integration Points</a></li>
                <li class="toc-level-1"><a href="#architecture-overview">Architecture Overview</a></li>
                <li class="toc-level-2"><a href="#current-state">Current State</a></li>
                <li class="toc-level-2"><a href="#integration-architecture">Integration Architecture</a></li>
                <li class="toc-level-1"><a href="#integration-strategy">Integration Strategy</a></li>
                <li class="toc-level-2"><a href="#approach">Approach: Clean Layer Integration</a></li>
                <li class="toc-level-2"><a href="#why-this-works">Why This Approach Works</a></li>
                <li class="toc-level-1"><a href="#implementation-phases">Implementation Phases</a></li>
                <li class="toc-level-2"><a href="#phase-1">Phase 1: Foundation (Week 1)</a></li>
                <li class="toc-level-2"><a href="#phase-2">Phase 2: Adventure Mode UI (Week 2)</a></li>
                <li class="toc-level-2"><a href="#phase-3">Phase 3: Network Integration (Week 3)</a></li>
                <li class="toc-level-2"><a href="#phase-4">Phase 4: Data Synchronization (Week 4)</a></li>
                <li class="toc-level-2"><a href="#phase-5">Phase 5: World Creation & Examples (Week 5)</a></li>
                <li class="toc-level-2"><a href="#phase-6">Phase 6: Polish & Testing (Week 6)</a></li>
                <li class="toc-level-1"><a href="#file-structure">File Structure</a></li>
                <li class="toc-level-1"><a href="#component-details">Component Details</a></li>
                <li class="toc-level-2"><a href="#hollowipeer">HollowIPeer Implementation</a></li>
                <li class="toc-level-2"><a href="#adventure-view">Adventure View Component</a></li>
                <li class="toc-level-1"><a href="#data-flow">Data Flow</a></li>
                <li class="toc-level-2"><a href="#solo-mode">Solo Mode (Single Player)</a></li>
                <li class="toc-level-2"><a href="#multiplayer-mode">Multiplayer Mode (Host/Guest)</a></li>
                <li class="toc-level-2"><a href="#character-sync">Character Stat Sync</a></li>
                <li class="toc-level-1"><a href="#testing-strategy">Testing Strategy</a></li>
                <li class="toc-level-2"><a href="#unit-tests">Unit Tests</a></li>
                <li class="toc-level-2"><a href="#integration-tests">Integration Tests</a></li>
                <li class="toc-level-1"><a href="#migration-path">Migration Path</a></li>
                <li class="toc-level-2"><a href="#phase-0">Phase 0: Preparation</a></li>
                <li class="toc-level-2"><a href="#post-integration">Post-Integration</a></li>
                <li class="toc-level-1"><a href="#success-metrics">Success Metrics</a></li>
                <li class="toc-level-2"><a href="#technical-metrics">Technical Metrics</a></li>
                <li class="toc-level-2"><a href="#ux-metrics">User Experience Metrics</a></li>
                <li class="toc-level-2"><a href="#integration-quality">Integration Quality</a></li>
                <li class="toc-level-1"><a href="#risk-assessment">Risk Assessment</a></li>
                <li class="toc-level-2"><a href="#high-risk">High Risk</a></li>
                <li class="toc-level-2"><a href="#medium-risk">Medium Risk</a></li>
                <li class="toc-level-2"><a href="#low-risk">Low Risk</a></li>
                <li class="toc-level-1"><a href="#appendix">Appendix</a></li>
                <li class="toc-level-2"><a href="#references">References</a></li>
                <li class="toc-level-2"><a href="#glossary">Glossary</a></li>
            </ul>
        </nav>

        <main id="content">
            <h2 id="executive-summary">Executive Summary</h2>

            <p>This plan integrates Textcraft's proven P2P text-based MUD engine into Hollow World RPG to add a <strong>text-based adventure mode</strong> alongside the existing graphical character sheet interface. The integration leverages Textcraft's <code>IPeer</code> abstraction to replace libp2p direct streams with Hollow's existing LibP2P infrastructure.</p>

            <h3 id="key-integration-points">Key Integration Points</h3>

            <ol>
                <li><strong>Network Layer</strong>: Implement Textcraft's <code>IPeer</code> interface using Hollow's <code>LibP2PNetworkProvider</code></li>
                <li><strong>MUD Engine</strong>: Import Textcraft's <code>MudConnection</code>, <code>World</code>, and <code>Thing</code> model as-is</li>
                <li><strong>UI Mode</strong>: Add "Adventure Mode" toggle to switch between character sheet and text MUD</li>
                <li><strong>World Sync</strong>: Sync Hollow character stats with Textcraft Thing properties</li>
            </ol>

            <hr>

            <h2 id="architecture-overview">Architecture Overview</h2>

            <h3 id="current-state">Current State</h3>

            <p><strong>Textcraft:</strong></p>
            <ul>
                <li>TypeScript-based text MUD engine</li>
                <li>Uses <code>IPeer</code> abstraction for networking</li>
                <li>Default implementation: <code>mudproto.ts</code> using libp2p direct streams</li>
                <li>Components:
                    <ul>
                        <li><code>model.ts</code> - Thing/World model (~2000 lines)</li>
                        <li><code>mudcontrol.ts</code> - Command system & MudConnection (~2500 lines)</li>
                        <li><code>peer.ts</code> - IPeer interface</li>
                        <li><code>gui.ts</code> - Text-based UI (~1000 lines)</li>
                    </ul>
                </li>
            </ul>

            <p><strong>Hollow World:</strong></p>
            <ul>
                <li>TypeScript RPG with graphical character sheets</li>
                <li>Uses LibP2P for P2P networking via <code>HollowPeer</code> and <code>LibP2PNetworkProvider</code></li>
                <li>Components:
                    <ul>
                        <li>Character management</li>
                        <li>Dice rolling</li>
                        <li>Combat system</li>
                        <li>Profile/storage system</li>
                    </ul>
                </li>
            </ul>

            <h3 id="integration-architecture">Integration Architecture</h3>

            <pre class="mermaid">
flowchart TD
    subgraph "Hollow World UI"
        CharSheet[Character Sheet View]
        AdventureMode[Adventure Mode View<br/>Textcraft GUI]
        ModeToggle{Mode Toggle}
    end

    subgraph "Hollow World Core"
        HollowPeer[HollowPeer<br/>P2P Coordinator]
        CharMgr[Character Manager]
        ProfileSvc[Profile Service]
    end

    subgraph "Textcraft Engine Integration"
        HollowIPeer[HollowIPeer<br/>implements IPeer]
        MudConn[MudConnection<br/>Per-user session]
        World[World/Thing Model]
        MudControl[MudControl<br/>Command system]
    end

    subgraph "Network Layer"
        LibP2P[LibP2PNetworkProvider<br/>Existing Hollow networking]
    end

    ModeToggle --> CharSheet
    ModeToggle --> AdventureMode

    AdventureMode --> MudControl
    MudControl --> MudConn
    MudConn --> World

    HollowPeer --> HollowIPeer
    HollowIPeer --> LibP2P

    MudControl --> HollowIPeer

    CharMgr <-.->|Sync stats| World
    ProfileSvc --> World

    style HollowIPeer fill:#ffd6d6,stroke:#333,color:#000
    style World fill:#d4edda,stroke:#333,color:#000
    style LibP2P fill:#fff3cd,stroke:#333,color:#000
            </pre>

            <hr>

            <h2 id="integration-strategy">Integration Strategy</h2>

            <h3 id="approach">Approach: Clean Layer Integration</h3>

            <p><strong>DO:</strong></p>
            <ul>
                <li><span class="checkmark">✅</span> Implement <code>IPeer</code> interface using Hollow's existing LibP2P infrastructure</li>
                <li><span class="checkmark">✅</span> Import Textcraft's core engine (<code>model.ts</code>, <code>mudcontrol.ts</code>) as separate modules</li>
                <li><span class="checkmark">✅</span> Create new "Adventure Mode" UI component</li>
                <li><span class="checkmark">✅</span> Sync Hollow character data with Textcraft Thing properties</li>
                <li><span class="checkmark">✅</span> Use Hollow's profile/storage system for World persistence</li>
            </ul>

            <p><strong>DON'T:</strong></p>
            <ul>
                <li><span class="crossmark">❌</span> Modify Textcraft's core engine code (keep it pristine for updates)</li>
                <li><span class="crossmark">❌</span> Replace Hollow's existing LibP2P setup</li>
                <li><span class="crossmark">❌</span> Mix Textcraft GUI directly into character sheet</li>
                <li><span class="crossmark">❌</span> Duplicate P2P infrastructure</li>
            </ul>

            <h3 id="why-this-works">Why This Approach Works</h3>

            <ol>
                <li><strong>Textcraft's IPeer abstraction</strong> was designed for exactly this - custom protocol implementations</li>
                <li><strong>Hollow already has LibP2P</strong> - we just need to adapt it to IPeer interface</li>
                <li><strong>Separate concerns</strong> - Character sheet and text adventure are distinct modes</li>
                <li><strong>Data sync</strong> - Hollow character stats flow into Textcraft Things as properties</li>
            </ol>

            <hr>

            <h2 id="implementation-phases">Implementation Phases</h2>

            <h3 id="phase-1">Phase 1: Foundation (Week 1)</h3>

            <p><strong>Goal:</strong> Import Textcraft core and implement basic IPeer adapter</p>

            <h4>Tasks:</h4>

            <ol>
                <li><strong>Import Textcraft Core</strong>
                    <pre><code>src/textcraft/
├── model.ts          # Thing/World model (copy from Textcraft)
├── mudcontrol.ts     # Command system (copy from Textcraft)
├── peer.ts           # IPeer interface (copy from Textcraft)
└── index.ts          # Re-exports</code></pre>
                </li>
                <li><strong>Create HollowIPeer Adapter</strong>
                    <pre><code class="language-typescript">// src/textcraft/hollow-peer.ts
import { IPeer } from './peer'
import { LibP2PNetworkProvider } from '../p2p/LibP2PNetworkProvider'

export class HollowIPeer implements IPeer {
  constructor(private networkProvider: LibP2PNetworkProvider) {}

  // Implement all 12 IPeer methods...
}</code></pre>
                </li>
                <li><strong>Unit Tests</strong>
                    <ul>
                        <li>Test HollowIPeer basic operations</li>
                        <li>Test createConnection()</li>
                        <li>Test command routing</li>
                    </ul>
                </li>
            </ol>

            <p><strong>Success Criteria:</strong></p>
            <ul>
                <li><span class="checkmark">✅</span> Textcraft core imports without errors</li>
                <li><span class="checkmark">✅</span> HollowIPeer implements all IPeer methods</li>
                <li><span class="checkmark">✅</span> Can create MudConnection instances</li>
                <li><span class="checkmark">✅</span> All unit tests pass</li>
            </ul>

            <h3 id="phase-2">Phase 2: Adventure Mode UI (Week 2)</h3>

            <p><strong>Goal:</strong> Create text-based adventure UI component</p>

            <h4>Tasks:</h4>

            <ol>
                <li><strong>Create AdventureView Component</strong>
                    <pre><code>src/components/adventure/
├── adventure-view.ts        # Main view controller
├── adventure-view.html      # Template
├── adventure-view.css       # Styling (western theme)
└── adventure-view.test.ts   # Tests</code></pre>
                </li>
                <li><strong>UI Features</strong>
                    <ul>
                        <li>Text output area (scrollable, western-styled)</li>
                        <li>Command input field</li>
                        <li>Command history (up/down arrows)</li>
                        <li>Mode toggle button (switch to character sheet)</li>
                        <li>Connection status indicator</li>
                    </ul>
                </li>
                <li><strong>Integration Points</strong>
                    <pre><code class="language-typescript">// In main.ts
const adventureView = new AdventureView(hollowPeer)
viewManager.registerView('adventure', adventureView)</code></pre>
                </li>
            </ol>

            <p><strong>Success Criteria:</strong></p>
            <ul>
                <li><span class="checkmark">✅</span> Can display text output</li>
                <li><span class="checkmark">✅</span> Can input commands</li>
                <li><span class="checkmark">✅</span> Command history works</li>
                <li><span class="checkmark">✅</span> Mode toggle switches views</li>
                <li><span class="checkmark">✅</span> Western theme consistent</li>
            </ul>

            <h3 id="phase-3">Phase 3: Network Integration (Week 3)</h3>

            <p><strong>Goal:</strong> Wire up HollowIPeer to actually work over LibP2P</p>

            <h4>Tasks:</h4>

            <ol>
                <li><strong>Implement IPeer Methods Using LibP2P</strong>
                    <pre><code class="language-typescript">class HollowIPeer implements IPeer {
  async startHosting() {
    // Load or create MUD world
    // Register stream handler for /hollow-mud/1.0.0
    // Create MudConnections for incoming guests
  }

  async joinSession(session: string) {
    // Parse multiaddr
    // Connect to host
    // Open stream on /hollow-mud/1.0.0
    // Send/receive commands
  }

  userThingChanged(thing: Thing) {
    // Broadcast user updates to all connected peers
  }

  command(cmd: string) {
    // Guest: send to host
    // Host: route to appropriate MudConnection
  }
}</code></pre>
                </li>
                <li><strong>Protocol Definition</strong>
                    <pre><code class="language-typescript">// Message types for /hollow-mud/1.0.0 protocol
interface MudMessage {
  type: 'command' | 'output' | 'userUpdate' | 'login'
  payload: any
}</code></pre>
                </li>
                <li><strong>Stream Handling</strong>
                    <ul>
                        <li>Register <code>/hollow-mud/1.0.0</code> protocol handler</li>
                        <li>Handle incoming connections (guest → host)</li>
                        <li>Create MudConnection per guest</li>
                        <li>Route messages bidirectionally</li>
                    </ul>
                </li>
            </ol>

            <p><strong>Success Criteria:</strong></p>
            <ul>
                <li><span class="checkmark">✅</span> Host can start hosting a MUD</li>
                <li><span class="checkmark">✅</span> Guest can connect to host</li>
                <li><span class="checkmark">✅</span> Commands flow host ↔ guest</li>
                <li><span class="checkmark">✅</span> Text output appears in both UIs</li>
                <li><span class="checkmark">✅</span> Multiple guests can connect</li>
            </ul>

            <h3 id="phase-4">Phase 4: Data Synchronization (Week 4)</h3>

            <p><strong>Goal:</strong> Sync Hollow character data with Textcraft Things</p>

            <h4>Tasks:</h4>

            <ol>
                <li><strong>Character → Thing Mapping</strong>
                    <pre><code class="language-typescript">class CharacterThingAdapter {
  syncToThing(character: Character, thing: Thing) {
    thing.properties.strength = character.attributes.brawn
    thing.properties.dexterity = character.attributes.finesse
    thing.properties.hp = character.hp.current
    thing.properties.maxHp = character.hp.max
    // ... etc
  }

  syncFromThing(thing: Thing, character: Character) {
    // Reverse sync (Thing changes → Character)
    // Useful for MUD-based stat modifications
  }
}</code></pre>
                </li>
                <li><strong>Bidirectional Sync</strong>
                    <ul>
                        <li>Character sheet changes → update Thing properties</li>
                        <li>Thing property changes → update character (via events)</li>
                        <li>Conflict resolution (last-write-wins initially)</li>
                    </ul>
                </li>
                <li><strong>Persistence Integration</strong>
                    <pre><code class="language-typescript">// Save MUD worlds using Hollow's profile storage
profileService.setItem('mud-world-' + worldName, worldData)</code></pre>
                </li>
            </ol>

            <p><strong>Success Criteria:</strong></p>
            <ul>
                <li><span class="checkmark">✅</span> Character stats appear as Thing properties</li>
                <li><span class="checkmark">✅</span> Changes in character sheet sync to MUD</li>
                <li><span class="checkmark">✅</span> Changes in MUD sync to character sheet</li>
                <li><span class="checkmark">✅</span> Worlds persist across sessions</li>
                <li><span class="checkmark">✅</span> Profile switching works correctly</li>
            </ul>

            <h3 id="phase-5">Phase 5: World Creation & Examples (Week 5)</h3>

            <p><strong>Goal:</strong> Create Hollow-themed MUD worlds</p>

            <h4>Tasks:</h4>

            <ol>
                <li><strong>Convert Textcraft Examples</strong>
                    <ul>
                        <li>Adapt Purgatory.yaml to Hollow theme (western frontier)</li>
                        <li>Create Hollow-specific examples:
                            <ul>
                                <li><code>Dusty Creek.yaml</code> - Starter town</li>
                                <li><code>The Badlands.yaml</code> - Dangerous wilderness</li>
                                <li><code>Sheriff's Office.yaml</code> - Tutorial area</li>
                            </ul>
                        </li>
                    </ul>
                </li>
                <li><strong>Hollow-Specific Extensions</strong>
                    <pre><code class="language-typescript">// Dice rolling in MUD
@js rollDice('1d20+3')

// Combat in text mode
@js combat(target)

// Inventory ↔ Character sheet
@js syncInventory()</code></pre>
                </li>
                <li><strong>World Builder</strong>
                    <ul>
                        <li>GUI for creating/editing MUD worlds</li>
                        <li>YAML export/import</li>
                        <li>Visual room layout (optional)</li>
                    </ul>
                </li>
            </ol>

            <p><strong>Success Criteria:</strong></p>
            <ul>
                <li><span class="checkmark">✅</span> 3+ Hollow-themed example worlds</li>
                <li><span class="checkmark">✅</span> Worlds include Hollow mechanics (dice, combat)</li>
                <li><span class="checkmark">✅</span> Can load/save custom worlds</li>
                <li><span class="checkmark">✅</span> Examples demonstrate key features</li>
            </ul>

            <h3 id="phase-6">Phase 6: Polish & Testing (Week 6)</h3>

            <p><strong>Goal:</strong> Production-ready integration</p>

            <h4>Tasks:</h4>

            <ol>
                <li><strong>Comprehensive Testing</strong>
                    <ul>
                        <li>Unit tests for all components</li>
                        <li>Integration tests for P2P flows</li>
                        <li>UI tests for adventure mode</li>
                        <li>Load testing (10+ concurrent users)</li>
                    </ul>
                </li>
                <li><strong>Error Handling</strong>
                    <ul>
                        <li>Network disconnections</li>
                        <li>Invalid commands</li>
                        <li>Sync conflicts</li>
                        <li>Storage corruption</li>
                    </ul>
                </li>
                <li><strong>Documentation</strong>
                    <ul>
                        <li>User guide for adventure mode</li>
                        <li>Developer guide for extending MUDs</li>
                        <li>API docs for HollowIPeer</li>
                        <li>Flow diagrams</li>
                    </ul>
                </li>
                <li><strong>Performance Optimization</strong>
                    <ul>
                        <li>Lazy loading of MUD engine</li>
                        <li>Message batching</li>
                        <li>Output throttling</li>
                        <li>Memory management</li>
                    </ul>
                </li>
            </ol>

            <p><strong>Success Criteria:</strong></p>
            <ul>
                <li><span class="checkmark">✅</span> All tests passing</li>
                <li><span class="checkmark">✅</span> Error handling robust</li>
                <li><span class="checkmark">✅</span> Documentation complete</li>
                <li><span class="checkmark">✅</span> Performance acceptable</li>
            </ul>

            <hr>

            <h2 id="file-structure">File Structure</h2>

            <pre><code>HollowWorld/
├── src/
│   ├── textcraft/                      # Textcraft integration
│   │   ├── model.ts                    # Thing/World model (from Textcraft)
│   │   ├── mudcontrol.ts               # Command system (from Textcraft)
│   │   ├── peer.ts                     # IPeer interface (from Textcraft)
│   │   ├── hollow-peer.ts              # HollowIPeer implementation
│   │   ├── character-thing-adapter.ts  # Character ↔ Thing sync
│   │   ├── storage-adapter.ts          # Hollow storage → MUD worlds
│   │   └── index.ts                    # Module exports
│   │
│   ├── components/
│   │   └── adventure/
│   │       ├── adventure-view.ts       # Main adventure UI
│   │       ├── adventure-view.html     # UI template
│   │       ├── adventure-view.css      # Western-themed styling
│   │       └── adventure-view.test.ts  # Tests
│   │
│   ├── p2p/
│   │   ├── LibP2PNetworkProvider.ts    # Existing (unchanged)
│   │   └── protocols/
│   │       └── mud-protocol.ts         # /hollow-mud/1.0.0 handler
│   │
│   └── main.ts                         # Updated with adventure mode
│
├── worlds/                             # MUD world files
│   ├── Dusty Creek.yaml
│   ├── The Badlands.yaml
│   └── Sheriff's Office.yaml
│
└── specs/
    ├── integrate-textcraft-2.md        # This file
    └── textcraft/                      # Cached Textcraft docs
        ├── developing.md
        ├── architecture.md
        └── ipeer-flow-diagram.md</code></pre>

            <hr>

            <h2 id="component-details">Component Details</h2>

            <h3 id="hollowipeer">HollowIPeer Implementation</h3>

            <p><strong>File:</strong> <code>src/textcraft/hollow-peer.ts</code></p>

            <pre><code class="language-typescript">import { IPeer, PeerID } from './peer'
import { Thing, MudStorage } from './model'
import { createConnection, MudConnection } from './mudcontrol'
import { LibP2PNetworkProvider } from '../p2p/LibP2PNetworkProvider'

export class HollowIPeer implements IPeer {
  currentVersionID: string = '1.0.0'
  versionID: string = '1.0.0'

  private networkProvider: LibP2PNetworkProvider
  private mudConnections: Map&lt;PeerID, MudConnection&gt; = new Map()
  private isHost: boolean = false
  private hostPeerID: PeerID | null = null

  constructor(networkProvider: LibP2PNetworkProvider) {
    this.networkProvider = networkProvider
  }

  init(app: any): void {
    // Called by textcraft.ts initialization
    console.log('HollowIPeer initialized')
  }

  async start(storage: MudStorage): void {
    // Register stream handler for /hollow-mud/1.0.0
    this.networkProvider.registerProtocolHandler(
      '/hollow-mud/1.0.0',
      this.handleIncomingStream.bind(this)
    )
  }

  reset(): void {
    // Close all MudConnections
    for (const mudcon of this.mudConnections.values()) {
      mudcon.close()
    }
    this.mudConnections.clear()
    this.isHost = false
    this.hostPeerID = null
  }

  connectString(): string {
    // Return multiaddr for direct connection
    return this.networkProvider.getMultiaddr()
  }

  relayConnectString(): string {
    // Return relay multiaddr (if using relay)
    return this.networkProvider.getRelayMultiaddr()
  }

  async startHosting(): void {
    this.isHost = true
    // Load or create world
    // Display connection string
    // Wait for guests to connect
  }

  async joinSession(session: string): void {
    this.isHost = false
    // Parse multiaddr
    // Connect to host
    // Begin login
  }

  startRelay(): void {
    throw new Error('Relay mode not supported in Hollow')
  }

  hostViaRelay(sessionID: string): void {
    throw new Error('Relay hosting not supported in Hollow')
  }

  userThingChanged(thing: Thing): void {
    if (!this.isHost) return

    // Find peer ID for this thing
    const peerID = this.findPeerIDForThing(thing)
    if (!peerID) return

    // Broadcast user update to all other peers
    const message = {
      type: 'userUpdate',
      peerID,
      name: thing.name,
      properties: thing.properties
    }

    this.broadcast(message, peerID)
  }

  command(cmd: string): void {
    if (this.isHost) {
      // Route to local MudConnection (host playing too)
      // This is an edge case - usually guests send commands
    } else {
      // Send to host
      this.sendToHost({
        type: 'command',
        text: cmd
      })
    }
  }

  // Private helper methods

  private async handleIncomingStream(stream: any, connection: any) {
    // New guest connecting
    const peerID = connection.remotePeer.toString()

    // Create MudConnection for this guest
    const mudcon = createConnection(
      this.currentWorld,
      (text: string) => {
        // Send output back to guest
        this.sendToGuest(peerID, {
          type: 'output',
          text
        })
      },
      true // remote = true
    )

    this.mudConnections.set(peerID, mudcon)

    // Handle incoming messages from guest
    this.setupStreamListener(stream, peerID)
  }

  private async setupStreamListener(stream: any, peerID: PeerID) {
    // Listen for messages from this peer
    // Route to appropriate MudConnection
  }

  private sendToHost(message: any) {
    // Send message to host peer
  }

  private sendToGuest(peerID: PeerID, message: any) {
    // Send message to specific guest
  }

  private broadcast(message: any, excludePeerID?: PeerID) {
    // Send to all connected guests except excluded one
  }

  private findPeerIDForThing(thing: Thing): PeerID | null {
    // Find which peer owns this thing
    for (const [peerID, mudcon] of this.mudConnections) {
      if (mudcon.thing === thing) {
        return peerID
      }
    }
    return null
  }
}</code></pre>

            <h3 id="adventure-view">Adventure View Component</h3>

            <p><strong>File:</strong> <code>src/components/adventure/adventure-view.ts</code></p>

            <pre><code class="language-typescript">import { HollowPeer } from '../../HollowPeer'
import { executeCommand } from '../../textcraft/mudcontrol'

export class AdventureView {
  private container: HTMLElement
  private outputArea: HTMLElement
  private inputField: HTMLInputElement
  private commandHistory: string[] = []
  private historyIndex: number = -1

  constructor(private hollowPeer: HollowPeer) {
    this.container = this.createContainer()
    this.setupEventListeners()
  }

  private createContainer(): HTMLElement {
    const template = document.getElementById('adventure-view-template') as HTMLTemplateElement
    const clone = template.content.cloneNode(true) as DocumentFragment
    return clone.firstElementChild as HTMLElement
  }

  private setupEventListeners() {
    this.inputField.addEventListener('keydown', (e) => {
      if (e.key === 'Enter') {
        this.handleCommand()
      } else if (e.key === 'ArrowUp') {
        this.navigateHistory(-1)
      } else if (e.key === 'ArrowDown') {
        this.navigateHistory(1)
      }
    })
  }

  private async handleCommand() {
    const cmd = this.inputField.value.trim()
    if (!cmd) return

    // Add to history
    this.commandHistory.push(cmd)
    this.historyIndex = this.commandHistory.length

    // Display command in output
    this.addOutput(`> ${cmd}`, 'command')

    // Execute command via mudcontrol
    try {
      await executeCommand(cmd)
    } catch (error) {
      this.addOutput(`Error: ${error.message}`, 'error')
    }

    // Clear input
    this.inputField.value = ''
  }

  public addOutput(text: string, className?: string) {
    const div = document.createElement('div')
    if (className) div.className = className
    div.innerHTML = text
    this.outputArea.appendChild(div)
    this.outputArea.scrollTop = this.outputArea.scrollHeight
  }

  private navigateHistory(direction: number) {
    // Up/down arrow navigation through command history
    const newIndex = this.historyIndex + direction
    if (newIndex >= 0 && newIndex < this.commandHistory.length) {
      this.historyIndex = newIndex
      this.inputField.value = this.commandHistory[this.historyIndex]
    } else if (newIndex === this.commandHistory.length) {
      this.historyIndex = newIndex
      this.inputField.value = ''
    }
  }

  public show() {
    this.container.style.display = 'block'
  }

  public hide() {
    this.container.style.display = 'none'
  }
}</code></pre>

            <hr>

            <h2 id="data-flow">Data Flow</h2>

            <h3 id="solo-mode">Solo Mode (Single Player)</h3>

            <pre class="mermaid">
sequenceDiagram
    participant User
    participant AdvView as Adventure View
    participant MudControl
    participant MudConn as MudConnection
    participant World

    User->>AdvView: Type "look"
    AdvView->>MudControl: executeCommand("look")
    MudControl->>MudConn: toplevelCommand("look")
    MudConn->>World: Query current room
    World-->>MudConn: Room description
    MudConn->>AdvView: output(description)
    AdvView->>User: Display text
            </pre>

            <h3 id="multiplayer-mode">Multiplayer Mode (Host/Guest)</h3>

            <pre class="mermaid">
sequenceDiagram
    participant Guest
    participant GuestAdv as Guest Adventure View
    participant HollowIPeer
    participant LibP2P
    participant HostIPeer as Host HollowIPeer
    participant HostMudConn as Host MudConnection
    participant World

    Guest->>GuestAdv: Type "look"
    GuestAdv->>HollowIPeer: command("look")
    HollowIPeer->>LibP2P: Send via /hollow-mud/1.0.0
    LibP2P->>HostIPeer: Receive command
    HostIPeer->>HostMudConn: toplevelCommand("look")
    HostMudConn->>World: Query room
    World-->>HostMudConn: Description
    HostMudConn->>HostIPeer: output(text)
    HostIPeer->>LibP2P: Send output
    LibP2P->>HollowIPeer: Receive output
    HollowIPeer->>GuestAdv: Display output
    GuestAdv->>Guest: Show text
            </pre>

            <h3 id="character-sync">Character Stat Sync</h3>

            <pre class="mermaid">
sequenceDiagram
    participant CharSheet as Character Sheet
    participant CharMgr as Character Manager
    participant Adapter as CharacterThingAdapter
    participant Thing
    participant MudConn as MudConnection

    Note over CharSheet,MudConn: User modifies stat in character sheet

    CharSheet->>CharMgr: updateAttribute('brawn', 12)
    CharMgr->>Adapter: syncToThing(character)
    Adapter->>Thing: setProperty('strength', 12)
    Thing->>MudConn: onPropertyChanged event
    MudConn->>MudConn: Recalculate derived stats

    Note over CharSheet,MudConn: MUD command modifies stat

    MudConn->>Thing: setProperty('hp', 8)
    Thing->>Adapter: onPropertyChanged event
    Adapter->>CharMgr: updateCharacter(property, value)
    CharMgr->>CharSheet: refresh()
            </pre>

            <hr>

            <h2 id="testing-strategy">Testing Strategy</h2>

            <h3 id="unit-tests">Unit Tests</h3>

            <p><strong>HollowIPeer:</strong></p>
            <pre><code class="language-typescript">describe('HollowIPeer', () => {
  it('should implement all IPeer methods', () => {
    const peer = new HollowIPeer(mockNetworkProvider)
    expect(peer.startHosting).toBeDefined()
    expect(peer.joinSession).toBeDefined()
    // ... etc
  })

  it('should create MudConnection for new guests', async () => {
    const peer = new HollowIPeer(mockNetworkProvider)
    await peer.startHosting()

    // Simulate guest connection
    await peer.handleIncomingStream(mockStream, mockConnection)

    expect(peer.mudConnections.size).toBe(1)
  })

  it('should route commands to correct MudConnection', async () => {
    // Test command routing
  })
})</code></pre>

            <p><strong>CharacterThingAdapter:</strong></p>
            <pre><code class="language-typescript">describe('CharacterThingAdapter', () => {
  it('should sync character stats to thing properties', () => {
    const adapter = new CharacterThingAdapter()
    const char = createMockCharacter()
    const thing = createMockThing()

    adapter.syncToThing(char, thing)

    expect(thing.properties.strength).toBe(char.attributes.brawn)
    expect(thing.properties.hp).toBe(char.hp.current)
  })

  it('should sync thing properties back to character', () => {
    // Test reverse sync
  })

  it('should handle conflicts with last-write-wins', () => {
    // Test conflict resolution
  })
})</code></pre>

            <h3 id="integration-tests">Integration Tests</h3>

            <p><strong>Solo Mode:</strong></p>
            <pre><code class="language-typescript">describe('Adventure Mode - Solo', () => {
  it('should load example world and display welcome', async () => {
    const view = new AdventureView(hollowPeer)
    await view.loadWorld('Dusty Creek')

    expect(view.outputArea.textContent).toContain('Welcome to Dusty Creek')
  })

  it('should execute commands and display output', async () => {
    const view = new AdventureView(hollowPeer)
    await view.handleCommand('look')

    expect(view.outputArea.textContent).toContain('You see')
  })
})</code></pre>

            <p><strong>Multiplayer Mode:</strong></p>
            <pre><code class="language-typescript">describe('Adventure Mode - Multiplayer', () => {
  it('should allow host to start hosting', async () => {
    const host = new HollowIPeer(hostNetworkProvider)
    await host.startHosting()

    expect(host.connectString()).toMatch(/^\/ip4\//)
  })

  it('should allow guest to connect to host', async () => {
    const host = new HollowIPeer(hostNetworkProvider)
    await host.startHosting()

    const guest = new HollowIPeer(guestNetworkProvider)
    await guest.joinSession(host.connectString())

    // Wait for connection
    await delay(100)

    expect(host.mudConnections.size).toBe(1)
  })

  it('should route commands from guest to host', async () => {
    // Setup host and guest
    // Guest sends "look"
    // Verify host MudConnection receives it
    // Verify guest receives output
  })
})</code></pre>

            <hr>

            <h2 id="migration-path">Migration Path</h2>

            <h3 id="phase-0">Phase 0: Preparation</h3>

            <ol>
                <li><strong>Cache Textcraft documentation locally:</strong>
                    <pre><code class="language-bash">mkdir -p specs/textcraft
cp ~/work/textcraft/developing.md specs/textcraft/
cp ~/work/textcraft/architecture.md specs/textcraft/
cp ~/work/textcraft/ipeer-flow-diagram.md specs/textcraft/</code></pre>
                </li>
                <li><strong>Review Textcraft code:</strong>
                    <ul>
                        <li>Understand IPeer interface contract</li>
                        <li>Study mudproto.ts implementation</li>
                        <li>Identify MudConnection usage patterns</li>
                    </ul>
                </li>
                <li><strong>Plan storage integration:</strong>
                    <ul>
                        <li>How to store MUD worlds in profile storage</li>
                        <li>How to handle world versioning</li>
                        <li>How to sync with character data</li>
                    </ul>
                </li>
            </ol>

            <h3>Phase 1-6: Execute Implementation Phases</h3>

            <p>(See Implementation Phases section above)</p>

            <h3 id="post-integration">Post-Integration</h3>

            <ol>
                <li><strong>Documentation:</strong>
                    <ul>
                        <li>Update Hollow README with adventure mode info</li>
                        <li>Create adventure mode user guide</li>
                        <li>Document HollowIPeer implementation</li>
                    </ul>
                </li>
                <li><strong>Examples:</strong>
                    <ul>
                        <li>Create 3-5 Hollow-themed example worlds</li>
                        <li>Add tutorial world for new players</li>
                        <li>Create advanced world showcasing features</li>
                    </ul>
                </li>
                <li><strong>Future Enhancements:</strong>
                    <ul>
                        <li>Visual world editor</li>
                        <li>Shared inventory between modes</li>
                        <li>MUD-based quests affecting character progression</li>
                        <li>Group adventures with party mechanics</li>
                    </ul>
                </li>
            </ol>

            <hr>

            <h2 id="success-metrics">Success Metrics</h2>

            <h3 id="technical-metrics">Technical Metrics</h3>

            <ul>
                <li><span class="checkmark">✅</span> All unit tests passing (>95% coverage)</li>
                <li><span class="checkmark">✅</span> Integration tests passing for solo and multiplayer modes</li>
                <li><span class="checkmark">✅</span> No regression in existing Hollow functionality</li>
                <li><span class="checkmark">✅</span> Performance: &lt;100ms command execution latency</li>
                <li><span class="checkmark">✅</span> Network: &lt;1KB average message size</li>
            </ul>

            <h3 id="ux-metrics">User Experience Metrics</h3>

            <ul>
                <li><span class="checkmark">✅</span> Mode switching feels seamless</li>
                <li><span class="checkmark">✅</span> Text output is readable and styled consistently</li>
                <li><span class="checkmark">✅</span> Multiplayer connections are reliable</li>
                <li><span class="checkmark">✅</span> Character stat sync is accurate</li>
                <li><span class="checkmark">✅</span> Example worlds are engaging</li>
            </ul>

            <h3 id="integration-quality">Integration Quality</h3>

            <ul>
                <li><span class="checkmark">✅</span> No modifications to Textcraft core code</li>
                <li><span class="checkmark">✅</span> Clean separation of concerns</li>
                <li><span class="checkmark">✅</span> Minimal changes to existing Hollow code</li>
                <li><span class="checkmark">✅</span> Documentation is comprehensive</li>
                <li><span class="checkmark">✅</span> Code follows Hollow's SOLID principles</li>
            </ul>

            <hr>

            <h2 id="risk-assessment">Risk Assessment</h2>

            <h3 id="high-risk">High Risk</h3>

            <p><strong>Network Protocol Mismatch</strong></p>
            <ul>
                <li><strong>Risk:</strong> LibP2P stream handling differs from Textcraft expectations</li>
                <li><strong>Mitigation:</strong> Thorough testing, protocol abstraction layer</li>
                <li><strong>Contingency:</strong> Fallback to simplified command/response model</li>
            </ul>

            <p><strong>State Synchronization Conflicts</strong></p>
            <ul>
                <li><strong>Risk:</strong> Character stats and Thing properties get out of sync</li>
                <li><strong>Mitigation:</strong> Clear sync boundaries, event-driven updates</li>
                <li><strong>Contingency:</strong> Lock to one source of truth, manual refresh option</li>
            </ul>

            <h3 id="medium-risk">Medium Risk</h3>

            <p><strong>Performance Issues</strong></p>
            <ul>
                <li><strong>Risk:</strong> Text parsing/rendering slows down with large output</li>
                <li><strong>Mitigation:</strong> Output throttling, virtual scrolling</li>
                <li><strong>Contingency:</strong> Reduce output verbosity, pagination</li>
            </ul>

            <p><strong>Storage Conflicts</strong></p>
            <ul>
                <li><strong>Risk:</strong> Profile switching causes world data loss</li>
                <li><strong>Mitigation:</strong> Proper profile-aware storage keys</li>
                <li><strong>Contingency:</strong> Export/import functionality for worlds</li>
            </ul>

            <h3 id="low-risk">Low Risk</h3>

            <p><strong>UI/UX Consistency</strong></p>
            <ul>
                <li><strong>Risk:</strong> Adventure mode feels out of place in Hollow</li>
                <li><strong>Mitigation:</strong> Consistent western theme, proper styling</li>
                <li><strong>Contingency:</strong> Treat as separate "mini-game" mode</li>
            </ul>

            <hr>

            <h2 id="appendix">Appendix</h2>

            <h3 id="references">References</h3>

            <ul>
                <li><strong>Textcraft Documentation:</strong>
                    <ul>
                        <li><code>developing.md</code> - Custom protocol implementation guide</li>
                        <li><code>architecture.md</code> - Thing model architecture</li>
                        <li><code>ipeer-flow-diagram.md</code> - IPeer usage flows</li>
                        <li><code>index.md</code> - Project overview</li>
                    </ul>
                </li>
                <li><strong>Hollow Documentation:</strong>
                    <ul>
                        <li><code>specs/p2p.md</code> - LibP2P networking specification</li>
                        <li><code>specs/main.md</code> - Architecture overview</li>
                    </ul>
                </li>
            </ul>

            <h3 id="glossary">Glossary</h3>

            <ul>
                <li><strong>IPeer</strong>: Textcraft's abstraction interface for P2P networking</li>
                <li><strong>MudConnection</strong>: Per-user session manager in Textcraft</li>
                <li><strong>Thing</strong>: Base object type in Textcraft's world model</li>
                <li><strong>World</strong>: Collection of Things representing a MUD instance</li>
                <li><strong>Adventure Mode</strong>: New Hollow UI mode for text-based play</li>
                <li><strong>HollowIPeer</strong>: Hollow's implementation of IPeer interface</li>
            </ul>

            <hr>

            <p><em>Plan created: 2025-10-19</em><br>
            <em>Next review: Start of Phase 1</em></p>
        </main>
    </div>

    <footer>
        <p>Textcraft Integration Plan for Hollow World | Generated from <a href="integrate-textcraft-2.md">integrate-textcraft-2.md</a></p>
    </footer>

    <script>
        // Initialize syntax highlighting
        document.addEventListener('DOMContentLoaded', (event) => {
            document.querySelectorAll('pre code').forEach((block) => {
                hljs.highlightElement(block);
            });

            // Smooth scroll for anchor links
            document.querySelectorAll('a[href^="#"]').forEach(anchor => {
                anchor.addEventListener('click', function (e) {
                    e.preventDefault();
                    const target = document.querySelector(this.getAttribute('href'));
                    if (target) {
                        target.scrollIntoView({
                            behavior: 'smooth',
                            block: 'start'
                        });
                    }
                });
            });

            // Active TOC link highlighting on scroll
            const observer = new IntersectionObserver((entries) => {
                entries.forEach(entry => {
                    const id = entry.target.getAttribute('id');
                    const tocLink = document.querySelector(`#toc a[href="#${id}"]`);
                    if (tocLink) {
                        if (entry.isIntersecting) {
                            document.querySelectorAll('#toc a').forEach(link => {
                                link.classList.remove('active');
                            });
                            tocLink.classList.add('active');
                        }
                    }
                });
            }, {
                rootMargin: '-200px 0px -80% 0px'
            });

            // Observe all headings
            document.querySelectorAll('#content h2, #content h3, #content h4').forEach((heading) => {
                observer.observe(heading);
            });
        });
    </script>
</body>
</html>
